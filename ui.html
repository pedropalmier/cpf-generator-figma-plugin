<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css">


<!-- ///////// Start of styles /////////-->
<style>
  body,
  html {
    margin: 0;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
  }

  .textbox-gray {
    display: flex;
    width: 128px;
    height: 32px;
    padding: 8px;
    justify-content: center;
    align-items: center;
    border-radius: 4px;
    background: #F3F3F3;
  }

  .icon--swap {
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .icon--swap:hover {
    background-color: #F3F3F3;
    border-radius: 4px;
  }

  .icon--swap:active {
    background-color: #D7D7D7;
    border-radius: 4px;
  }

  .button--primary {
    width: 72px;
    min-width: 72px;
    justify-content: center;
    align-items: center;
    /* Garante que n√£o muda */
  }

  .button--primary:active {
    background-color: #005AC4;
  }
</style>

<!-- ///////// Start of HTML elements /////////-->

<!-- Switch -->
<div class="switch">
  <input class="switch__toggle" type="checkbox" id="toggle-cpf-format">
  <label class="switch__label" for="toggle-cpf-format">Format</label>
</div>


<!-- CPF Display -->
<div class="textbox-gray" id="textbox">
  <div class="type type--xlarge" id="cpf-display">12345678901</div>
</div>


<!-- Swap icon -->
<div class="icon icon--swap" id="btn-generate"></div>


<!-- Primary -->
<button class='button button--primary' id="btn-copy">Copy</button>


<!-- ///////// Start of scripts /////////-->
<script>
  let currentCPF = '';

  window.onmessage = (event) => {
    const msg = event.data.pluginMessage;
    if (!msg) return;
    if (msg.type === 'copy-to-clipboard') {
      const textarea = document.createElement('textarea');
      textarea.value = msg.text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
    }
  };

  function generateCPF() {
    let cpf = '';
    for (let i = 0; i < 9; i++) {
      cpf += Math.floor(Math.random() * 10);
    }

    let sum = 0;
    for (let i = 0; i < 9; i++) {
      sum += parseInt(cpf.charAt(i)) * (10 - i);
    }
    let remainder = sum % 11;
    let digit1 = remainder < 2 ? 0 : 11 - remainder;
    cpf += digit1;

    sum = 0;
    for (let i = 0; i < 10; i++) {
      sum += parseInt(cpf.charAt(i)) * (11 - i);
    }
    remainder = sum % 11;
    let digit2 = remainder < 2 ? 0 : 11 - remainder;
    cpf += digit2;

    return cpf;
  }

  function formatCPF(cpf) {
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
  }

  function displayCPF() {
    const isFormatted = document.getElementById('toggle-cpf-format').checked;
    const displayText = isFormatted ? formatCPF(currentCPF) : currentCPF;
    document.getElementById('cpf-display').textContent = displayText;
  }

  function displayNewCPF() {
    currentCPF = generateCPF();
    displayCPF();
  }

  function copyCPF() {
    const isFormatted = document.getElementById('toggle-cpf-format').checked;
    const textToCopy = isFormatted ? formatCPF(currentCPF) : currentCPF;

    parent.postMessage({ pluginMessage: { type: 'copy', text: textToCopy } }, '*');

    const button = document.getElementById('btn-copy');
    button.textContent = 'Copied!';

    setTimeout(() => {
      button.textContent = 'Copy';
    }, 2000);
  }

  document.getElementById('btn-generate').addEventListener('click', displayNewCPF);
  document.getElementById('btn-copy').addEventListener('click', copyCPF);
  document.getElementById('toggle-cpf-format').addEventListener('change', displayCPF);

  displayNewCPF();
</script>